<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>台灣小吃部｜線上學習</title>
  <meta name="description" content="台灣小吃部：用台味把手藝保存下來。熱門課程、最新公告、免登入體驗。" />
  <style>
    :root{
      --paper:#fbf7ee;
      --ink:#1f1f1f;
      --muted:#6b6b6b;
      --line:#e6dccb;
      --stamp:#cf2e2e;
      --accent:#0f766e;
      --card:#fffdf7;
      --shadow: 0 10px 25px rgba(0,0,0,.08);
      --radius:14px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background:
        radial-gradient(900px 500px at 20% 0%, rgba(207,46,46,.07), transparent 60%),
        radial-gradient(800px 500px at 80% 10%, rgba(15,118,110,.06), transparent 60%),
        var(--paper);
      line-height:1.55;
    }
    a{color:inherit}
    .container{max-width:980px;margin:0 auto;padding:0 16px}
    .topbar{
      position:sticky;top:0;z-index:20;
      background: rgba(251,247,238,.85);
      backdrop-filter: blur(8px);
      border-bottom:1px solid var(--line);
    }
    .topbar .inner{
      display:flex;align-items:center;justify-content:space-between;
      padding:12px 0;
      gap:10px;
    }
    .brand{
      display:flex;align-items:center;gap:10px;text-decoration:none;
    }
    .mark{
      width:34px;height:34px;border-radius:10px;
      background: linear-gradient(135deg, rgba(207,46,46,.95), rgba(207,46,46,.75));
      box-shadow: 0 8px 18px rgba(207,46,46,.18);
      position:relative;
    }
    .mark:after{
      content:"小";
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      color:white;font-weight:900;
      letter-spacing:.1em;
    }
    .brand-title{
      font-weight:900;
      letter-spacing:.06em;
    }
    .nav{
      display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;
      font-size:14px;
    }
    .nav a{
      padding:6px 10px;border-radius:999px;
      text-decoration:none;color:var(--muted);
      border:1px solid transparent;
    }
    .nav a:hover{color:var(--ink);border-color:var(--line);background:rgba(255,255,255,.6)}
    .hero{padding:22px 0 10px}
    .paper{
      background: var(--card);
      border:1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .paper .pad{padding:16px}
    .hero-grid{
      display:grid;grid-template-columns:1.2fr .8fr;gap:14px;
    }
    h1{
      margin:0 0 10px;
      font-size:28px;
      letter-spacing:.02em;
    }
    .sub{
      margin:0 0 14px;
      color:var(--muted);
      max-width:60ch;
      font-size:15px;
    }
    .stamp{
      display:inline-flex;align-items:center;gap:8px;
      border:2px solid var(--stamp);
      color:var(--stamp);
      border-radius:999px;
      padding:6px 10px;
      font-weight:900;
      letter-spacing:.08em;
      font-size:12px;
      user-select:none;
      transform: rotate(-1deg);
    }
    .btn{
      appearance:none;border:1px solid var(--line);
      background:white;
      color:var(--ink);
      padding:10px 12px;border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{
      border-color: transparent;
      background: var(--stamp);
      color:white;
    }
    .btn.ghost{
      background:transparent;
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .kiosk{
      border-left:2px dashed var(--line);
      padding-left:14px;
    }
    .kiosk h3{margin:0 0 8px;font-size:14px}
    .kiosk .kv{
      display:grid;grid-template-columns:1fr 1fr;gap:10px;
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
    }
    .kv .box{
      border:1px dashed var(--line);
      border-radius:12px;
      padding:10px;
      background: rgba(251,247,238,.7);
    }

    section{padding:14px 0}
    .section-head{
      display:flex;align-items:end;justify-content:space-between;gap:10px;margin-bottom:10px;
    }
    .section-head h2{margin:0;font-size:18px}
    .hint{color:var(--muted);font-size:13px}

    .controls{
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
    }
    .input, select{
      padding:10px 12px;border-radius:12px;
      border:1px solid var(--line);
      background:white;
      font-family:var(--sans);
      font-size:14px;
      outline:none;
    }
    .input{min-width:220px;flex:1}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{
      padding:6px 10px;border-radius:999px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.7);
      font-size:13px;color:var(--muted);
      cursor:pointer;
      user-select:none;
    }
    .chip.active{
      border-color: rgba(207,46,46,.35);
      background: rgba(207,46,46,.08);
      color: var(--ink);
      font-weight:800;
    }

    .menu{
      border-top:1px solid var(--line);
    }
    .menu-row{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      background: rgba(255,255,255,.55);
    }
    .menu-row:hover{background: rgba(255,255,255,.85)}
    .menu-title{
      display:flex;gap:10px;flex-wrap:wrap;align-items:baseline;
    }
    .menu-title b{font-size:15px}
    .menu-meta{
      font-family:var(--mono);
      font-size:12px;color:var(--muted);
    }
    .tag{
      font-size:12px;
      padding:3px 8px;
      border:1px solid var(--line);
      border-radius:999px;
      color:var(--muted);
      background: rgba(251,247,238,.8);
    }
    .price{
      font-family:var(--mono);
      font-size:12px;
      color:var(--muted);
      text-align:right;
      white-space:nowrap;
    }
    .actions{display:flex;gap:8px;justify-content:flex-end;flex-wrap:wrap;margin-top:8px}

    .news{
      display:grid;grid-template-columns:1fr;gap:10px;
    }
    .note{
      padding:12px 14px;
      border:1px solid var(--line);
      border-radius:14px;
      background: rgba(255,255,255,.7);
    }
    .note b{display:block;margin-bottom:4px}
    .note .d{font-family:var(--mono);font-size:12px;color:var(--muted)}
    .note p{margin:6px 0 0;color:var(--muted);font-size:14px}

    .try{
      display:grid;grid-template-columns:1fr 1fr;gap:12px;
    }
    .try .box{
      border:1px dashed var(--line);
      border-radius:14px;
      padding:14px;
      background: rgba(255,255,255,.7);
    }
    .try h3{margin:0 0 8px;font-size:14px}
    .fine{margin:0;color:var(--muted);font-size:13px}

    footer{
      margin-top:18px;
      border-top:1px solid var(--line);
      padding:16px 0 22px;
      color:var(--muted);
      font-size:14px;
    }
    .foot{
      display:flex;justify-content:space-between;gap:12px;flex-wrap:wrap;
    }
    .small{font-size:12px;color:var(--muted)}
    .right{text-align:right}

    /* Modal */
    .backdrop{
      position:fixed;inset:0;
      background: rgba(0,0,0,.25);
      display:none;
      align-items:center;justify-content:center;
      padding:16px;
      z-index:50;
    }
    .modal{
      width:min(680px,100%);
      background: var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modal-head{
      display:flex;justify-content:space-between;align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: rgba(251,247,238,.8);
    }
    .modal-head b{letter-spacing:.04em}
    .modal-body{padding:14px}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .kv2{
      border:1px dashed var(--line);
      border-radius:14px;
      padding:12px;
      background: rgba(255,255,255,.65);
    }
    .kv2 .k{font-family:var(--mono);font-size:12px;color:var(--muted)}
    .kv2 .v{margin-top:6px;font-size:14px}
    .bars{display:grid;gap:8px;margin-top:10px}
    .bar{
      display:grid;grid-template-columns:70px 1fr 34px;gap:10px;align-items:center;
      font-family:var(--mono);font-size:12px;color:var(--muted);
    }
    .track{height:10px;border-radius:999px;background: rgba(0,0,0,.06);overflow:hidden;border:1px solid var(--line)}
    .fill{height:100%;background: rgba(207,46,46,.6)}
    .fill.alt{background: rgba(15,118,110,.55)}
    @media (max-width: 820px){
      .hero-grid{grid-template-columns:1fr}
      .kiosk{border-left:none;border-top:2px dashed var(--line);padding-left:0;padding-top:14px}
      .try{grid-template-columns:1fr}
      .grid2{grid-template-columns:1fr}
      .nav{justify-content:flex-start}
      h1{font-size:24px}
      .input{min-width:160px}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="container inner">
      <a class="brand" href="#top">
        <div class="mark" aria-hidden="true"></div>
        <div>
          <div class="brand-title">台灣小吃部</div>
          <div class="small">Taiwan Snack Lab</div>
        </div>
      </a>
      <nav class="nav">
        <a href="#menu">熱門課程</a>
        <a href="#news">最新公告</a>
        <a href="#try">免登入體驗</a>
        <a href="#contact">聯繫</a>
      </nav>
    </div>
  </div>

  <main id="top" class="container">
    <div class="hero">
      <div class="paper">
        <div class="pad hero-grid">
          <div>
            <div class="stamp">今日主打｜台味味譜</div>
            <h1>像小吃店菜單一樣簡單，<br/>把手藝一份一份存下來。</h1>
            <p class="sub">
              不用登入也能看課程、試體驗、收藏菜單。<br/>
              之後真的要付費/跨裝置同步，再加登入就好。
            </p>
            <div class="row">
              <a class="btn primary" href="#menu">看看菜單</a>
              <a class="btn ghost" href="#try">先試一下</a>
              <button class="btn" id="btnShowFav">我的收藏</button>
            </div>
          </div>
          <div class="kiosk">
            <h3>小吃部櫃台</h3>
            <div class="kv">
              <div class="box">營業中：<b id="openState">是</b></div>
              <div class="box">今日上架：<b id="todayCount">—</b></div>
              <div class="box">熱門分類：<b id="topCat">—</b></div>
              <div class="box">收藏數：<b id="favCount">0</b></div>
            </div>
            <p class="fine" style="margin-top:10px">
              ※ 目前是純前端：資料由 <code>data/courses.json</code> 讀取，速度快、成本低。
            </p>
          </div>
        </div>
      </div>
    </div>

    <section id="menu">
      <div class="section-head">
        <h2>熱門課程（菜單）</h2>
        <div class="hint">搜尋/分類 → 點一項看詳情</div>
      </div>

      <div class="paper">
        <div class="pad">
          <div class="controls">
            <input class="input" id="q" placeholder="想學什麼？例如：滷肉、雞排、珍奶…" />
            <select id="cat">
              <option value="">全部分類</option>
            </select>
            <select id="level">
              <option value="">全部程度</option>
              <option value="入門">入門</option>
              <option value="中階">中階</option>
              <option value="進階">進階</option>
            </select>
            <button class="btn" id="btnReset">清除</button>
          </div>

          <div style="margin-top:10px" class="chips" id="chipRow"></div>
        </div>

        <div class="menu" id="menuList">
          <div class="menu-row">
            <div class="menu-title"><b>載入中…</b></div>
            <div class="price">—</div>
          </div>
        </div>
      </div>
    </section>

    <section id="news">
      <div class="section-head">
        <h2>最新公告</h2>
        <div class="hint">像店門口的小黑板</div>
      </div>
      <div class="news" id="newsList"></div>
    </section>

    <section id="try">
      <div class="section-head">
        <h2>免登入體驗</h2>
        <div class="hint">先玩一下再決定要不要買單</div>
      </div>
      <div class="paper">
        <div class="pad try">
          <div class="box">
            <h3>1 分鐘小測驗</h3>
            <p class="fine">Q：滷製時「小火」的主要目的？</p>
            <div class="row" style="margin-top:10px">
              <button class="btn" data-ans="A">A. 讓表面焦香更快</button>
              <button class="btn" data-ans="B">B. 讓味道慢慢滲入</button>
              <button class="btn" data-ans="C">C. 降低成本</button>
            </div>
            <p id="quizOut" class="fine" style="margin-top:10px"></p>
          </div>
          <div class="box">
            <h3>快速推薦（示範）</h3>
            <p class="fine">輸入你今天想要的感覺，我幫你挑菜單。</p>
            <div class="row" style="margin-top:10px">
              <input class="input" id="mood" placeholder="例如：想要脆、微辣、下酒" />
              <button class="btn primary" id="btnPick">挑 3 個</button>
            </div>
            <div id="pickOut" class="fine" style="margin-top:10px"></div>
          </div>
        </div>
      </div>
    </section>

    <footer id="contact">
      <div class="container">
        <div class="foot">
          <div>
            <b>聯繫</b><br/>
            Email：<a href="mailto:hello@snacklab.tw">hello@snacklab.tw</a><br/>
            IG：<a href="#" onclick="alert('之後換成你的 IG 連結');return false;">@snacklab.tw</a><br/>
            <span class="small">（地址可選：桃園／台北）</span>
          </div>
          <div class="right">
            <span class="small">© <span id="year"></span> 台灣小吃部</span><br/>
            <span class="small">「像小吃店」極簡版本</span>
          </div>
        </div>
      </div>
    </footer>
  </main>

  <!-- Course Modal -->
  <div class="backdrop" id="backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modal-head">
        <b id="mTitle">課程</b>
        <div class="row">
          <button class="btn" id="btnFav">收藏</button>
          <button class="btn" id="btnClose">關閉</button>
        </div>
      </div>
      <div class="modal-body">
        <div class="grid2">
          <div class="kv2">
            <div class="k">基本資訊</div>
            <div class="v" id="mMeta">—</div>
            <p class="fine" id="mSummary" style="margin-top:10px">—</p>
            <div class="row" id="mTags" style="margin-top:10px"></div>
          </div>
          <div class="kv2">
            <div class="k">台味味譜（0–5）</div>
            <div class="bars" id="mBars"></div>
            <p class="fine" style="margin-top:10px">※ 先做味譜，之後再擴充食感/歸屬感。</p>
          </div>
        </div>
        <div class="actions" style="margin-top:12px">
          <a class="btn primary" href="#try" onclick="closeModal()">先體驗</a>
          <a class="btn" href="#contact" onclick="closeModal()">詢問/合作</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- State ----------
    let courses = [];
    let filtered = [];
    let activeTag = "";
    let currentCourseId = "";
    const FAV_KEY = "snacklab_favs_v1";

    const news = [
      { date:"2026-01-27", title:"小吃店極簡版上線", body:"先把網站動起來：菜單、公告、免登入體驗。後面再接付費/會員。"},
      { date:"2026-01-25", title:"課程資料改用 courses.json", body:"方便未來從試算表同步生成，不影響前端。"},
      { date:"2026-01-20", title:"味譜系統規劃中", body:"先做味譜（鹹甜酸辣鮮麻），之後擴充食感與歸屬感。"}
    ];

    // ---------- Helpers ----------
    const $ = (s)=>document.querySelector(s);
    const esc = (s)=>String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#39;");
    const uniq = (arr)=>Array.from(new Set(arr.filter(Boolean)));
    const clamp = (n,min,max)=>Math.max(min,Math.min(max,n));

    function readFavs(){
      try{ return JSON.parse(localStorage.getItem(FAV_KEY) || "[]"); }catch{ return []; }
    }
    function writeFavs(ids){
      localStorage.setItem(FAV_KEY, JSON.stringify(ids));
      $("#favCount").textContent = String(ids.length);
    }
    function toggleFav(id){
      const ids = readFavs();
      const idx = ids.indexOf(id);
      if(idx >= 0) ids.splice(idx,1); else ids.push(id);
      writeFavs(ids);
      return ids.includes(id);
    }
    function isFav(id){ return readFavs().includes(id); }

    // ---------- Rendering ----------
    function renderNews(){
      const host = $("#newsList");
      host.innerHTML = news.map(n=>`
        <div class="note">
          <div class="d">${esc(n.date)}</div>
          <b>${esc(n.title)}</b>
          <p>${esc(n.body)}</p>
        </div>
      `).join("");
    }

    function renderChips(){
      const allTags = uniq(courses.flatMap(c=>c.tags || []));
      const hot = ["熱門","人氣","最新","台味","夜市","家常"];
      const tags = uniq([...hot, ...allTags]).slice(0, 18);
      const host = $("#chipRow");
      host.innerHTML = tags.map(t=>`
        <span class="chip ${t===activeTag ? "active":""}" data-tag="${esc(t)}">${esc(t)}</span>
      `).join("");
      host.querySelectorAll(".chip").forEach(ch=>{
        ch.addEventListener("click", ()=>{
          const t = ch.getAttribute("data-tag");
          activeTag = (activeTag === t) ? "" : t;
          renderChips();
          applyFilter();
        });
      });
    }

    function renderCategoryOptions(){
      const cats = uniq(courses.map(c=>c.category));
      const sel = $("#cat");
      sel.innerHTML = `<option value="">全部分類</option>` + cats.map(c=>`<option value="${esc(c)}">${esc(c)}</option>`).join("");
    }

    function renderMenu(list){
      const host = $("#menuList");
      if(!list.length){
        host.innerHTML = `
          <div class="menu-row">
            <div class="menu-title"><b>找不到符合的菜單</b><span class="tag">換個關鍵字試試</span></div>
            <div class="price">—</div>
          </div>
        `;
        return;
      }

      host.innerHTML = list.map(c=>{
        const meta = `${c.minutes ?? 0} 分｜${c.level || ""}｜${c.category || ""}`;
        const tags = (c.tags || []).slice(0,3);
        const favMark = isFav(c.id) ? "★" : "☆";
        return `
          <div class="menu-row" data-id="${esc(c.id)}">
            <div>
              <div class="menu-title">
                <b>${esc(c.title)}</b>
                ${tags.map(t=>`<span class="tag">${esc(t)}</span>`).join("")}
              </div>
              <div class="menu-meta">${esc(meta)}</div>
            </div>
            <div class="price">
              ${favMark} 收藏<br/>
              <span class="small">點我看詳情</span>
            </div>
          </div>
        `;
      }).join("");

      host.querySelectorAll(".menu-row").forEach(row=>{
        row.addEventListener("click", ()=>{
          openCourse(row.getAttribute("data-id"));
        });
      });
    }

    function updateKiosk(){
      $("#todayCount").textContent = String(courses.length);
      const catCount = new Map();
      courses.forEach(c=>{
        const k = c.category || "其他";
        catCount.set(k, (catCount.get(k) || 0) + 1);
      });
      let top = "—", best = 0;
      for(const [k,v] of catCount.entries()){ if(v>best){ best=v; top=k; } }
      $("#topCat").textContent = top;
      writeFavs(readFavs());
    }

    // ---------- Filtering ----------
    function applyFilter(){
      const q = ($("#q").value || "").trim().toLowerCase();
      const cat = $("#cat").value || "";
      const level = $("#level").value || "";

      filtered = courses.filter(c=>{
        const inQ =
          !q ||
          (c.title || "").toLowerCase().includes(q) ||
          (c.summary || "").toLowerCase().includes(q) ||
          (c.category || "").toLowerCase().includes(q) ||
          (c.tags || []).some(t => String(t).toLowerCase().includes(q));

        const inCat = !cat || c.category === cat;
        const inLevel = !level || c.level === level;
        const inTag = !activeTag || (c.tags || []).includes(activeTag);

        return inQ && inCat && inLevel && inTag;
      });

      renderMenu(filtered);
    }

    // ---------- Modal ----------
    const backdrop = $("#backdrop");

    function closeModal(){
      backdrop.style.display = "none";
      backdrop.setAttribute("aria-hidden","true");
      currentCourseId = "";
    }

    function openCourse(id){
      const c = courses.find(x=>x.id === id);
      if(!c) return;

      currentCourseId = id;
      $("#mTitle").textContent = c.title || "課程";
      $("#mMeta").textContent = `${c.minutes ?? 0} 分鐘｜${c.level || ""}｜${c.category || ""}`;
      $("#mSummary").textContent = c.summary || "（尚未填寫摘要）";

      const tags = uniq([...(c.tags||[]), ...(c.belonging||[])]);
      $("#mTags").innerHTML = tags.slice(0, 10).map(t=>`<span class="tag">${esc(t)}</span>`).join("");

      const f = c.flavour || {};
      const rows = [
        ["鹹", f.salty ?? 0, "fill"],
        ["甜", f.sweet ?? 0, "fill alt"],
        ["酸", f.sour ?? 0, "fill"],
        ["辣", f.spicy ?? 0, "fill alt"],
        ["鮮", f.umami ?? 0, "fill"],
        ["麻", f.numbing ?? 0, "fill alt"]
      ];
      $("#mBars").innerHTML = rows.map(([name,val,klass])=>{
        const v = clamp(Number(val)||0,0,5);
        return `
          <div class="bar">
            <span>${name}</span>
            <div class="track"><div class="${klass}" style="width:${v*20}%"></div></div>
            <span>${v}</span>
          </div>
        `;
      }).join("");

      const fav = isFav(id);
      $("#btnFav").textContent = fav ? "已收藏 ★" : "收藏 ☆";

      backdrop.style.display = "flex";
      backdrop.setAttribute("aria-hidden","false");
    }

    // ---------- Load ----------
    async function loadCourses(){
      try{
        const res = await fetch("./data/courses.json", { cache: "no-store" });
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        courses = Array.isArray(data) ? data : [];
      }catch(err){
        console.error(err);
        courses = [];
      }
    }

    // ---------- Events ----------
    function bindEvents(){
      $("#btnReset").addEventListener("click", ()=>{
        $("#q").value = "";
        $("#cat").value = "";
        $("#level").value = "";
        activeTag = "";
        renderChips();
        applyFilter();
      });

      ["q","cat","level"].forEach(id=>{
        $("#"+id).addEventListener("input", applyFilter);
        $("#"+id).addEventListener("change", applyFilter);
      });

      // Quiz
      document.querySelectorAll("[data-ans]").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const ans = btn.getAttribute("data-ans");
          $("#quizOut").textContent = (ans==="B")
            ? "✅ 對：小火讓味道慢慢滲入，也比較穩定不易焦。"
            : "❌ 不太對：提示是『慢慢滲入』與『穩定』。";
        });
      });

      // Pick 3
      $("#btnPick").addEventListener("click", ()=>{
        if(!courses.length){ $("#pickOut").textContent = "目前沒有菜單資料。"; return; }
        const shuffled = [...courses].sort(()=>Math.random()-0.5).slice(0,3);
        $("#pickOut").innerHTML = shuffled.map(c=>`• <a href="#menu" onclick="openCourse('${esc(c.id)}')">${esc(c.title)}</a>`).join("<br/>");
      });

      // Fav modal show
      $("#btnShowFav").addEventListener("click", ()=>{
        const ids = readFavs();
        if(!ids.length){ alert("你還沒有收藏。先點幾個菜單看看～"); return; }
        const list = courses.filter(c=>ids.includes(c.id));
        const names = list.map(c=>`• ${c.title}`).join("\n");
        alert("我的收藏：\n" + names);
      });

      // Modal close
      $("#btnClose").addEventListener("click", closeModal);
      backdrop.addEventListener("click", (e)=>{ if(e.target === backdrop) closeModal(); });

      // Fav button
      $("#btnFav").addEventListener("click", ()=>{
        if(!currentCourseId) return;
        const nowFav = toggleFav(currentCourseId);
        $("#btnFav").textContent = nowFav ? "已收藏 ★" : "收藏 ☆";
        // refresh menu marks
        applyFilter();
      });
    }

    // ---------- Init ----------
    window.addEventListener("DOMContentLoaded", async ()=>{
      $("#year").textContent = new Date().getFullYear();
      renderNews();
      bindEvents();

      await loadCourses();
      updateKiosk();
      renderCategoryOptions();
      renderChips();
      applyFilter();
    });
  </script>
</body>
</html>
